Homework 6
================

# Problem 2

## Clean Data

1.  Loaded the data
2.  Created the following variables:
    -   city_state
    -   case_solved: binary variable where 0 = case unresolved, 1 = case
        resolved
3.  Filtered the data in the following ways:
    -   For city_state, removed Dallax, TX; Phoenix, AZ; Kansas City,
        MO; Tulsa, AL
    -   For victim_race, only included White & Black
4.  Converted victim_age’s data type from char to numeric

``` r
homicide_df = read.csv('data/homicide.csv') %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, state, sep = ", "),
         case_solved = as.numeric(case_when(
           disposition == "Closed without arrest" ~ "0",
           disposition == "Open/No arrest" ~ "0",
           disposition == "Closed by arrest" ~ "1"))) %>% 
  filter(city_state != "Tulsa, AL", 
         city_state != "Dallas, TX", 
         city_state != "Phoenix, AZ", 
         city_state != "Kansas City, MO", 
         victim_race %in% c("White" ,"Black")) %>% 
  mutate(victim_age = as.numeric(victim_age))
```

## Baltimore, MD: GLM

1.  Created a new data frame called homicide_baltimore

``` r
homicide_baltimore = homicide_df %>% 
  filter(city_state == "Baltimore, MD")
```

2.  Fit a log reg (outcome = case_solved, predictors = age, sex, race)
3.  Save glm output 4.. Find CI & estimate for odds ratio for male
    vs. female (victim_sexMale row)

``` r
baltimore_log_fit = 
  homicide_baltimore %>% 
  glm(case_solved ~ victim_age + victim_race + victim_sex, data = ., family = binomial()) 

summary(baltimore_log_fit)
```

    ## 
    ## Call:
    ## glm(formula = case_solved ~ victim_age + victim_race + victim_sex, 
    ##     family = binomial(), data = .)
    ## 
    ## Deviance Residuals: 
    ##     Min       1Q   Median       3Q      Max  
    ## -1.6223  -0.8958  -0.8688   1.4699   1.6579  
    ## 
    ## Coefficients:
    ##                   Estimate Std. Error z value Pr(>|z|)    
    ## (Intercept)       0.309981   0.171295   1.810   0.0704 .  
    ## victim_age       -0.006727   0.003324  -2.024   0.0430 *  
    ## victim_raceWhite  0.841756   0.174716   4.818 1.45e-06 ***
    ## victim_sexMale   -0.854463   0.138176  -6.184 6.26e-10 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## (Dispersion parameter for binomial family taken to be 1)
    ## 
    ##     Null deviance: 3567.9  on 2752  degrees of freedom
    ## Residual deviance: 3492.7  on 2749  degrees of freedom
    ## AIC: 3500.7
    ## 
    ## Number of Fisher Scoring iterations: 4

``` r
baltimore_log_fit %>% 
  broom::tidy() %>% 
  mutate(OR = exp(estimate),
         OR_CI_lower = exp(OR - 1.96*(std.error)),
         OR_CI_upper = exp(OR + 1.96*(std.error))) %>% 
  select(term, log_OR = estimate, OR, OR_CI_lower, OR_CI_upper, p.value) %>% 
  knitr::kable()
```

| term             |     log_OR |        OR | OR_CI_lower | OR_CI_upper |   p.value |
|:-----------------|-----------:|----------:|------------:|------------:|----------:|
| (Intercept)      |  0.3099810 | 1.3633992 |    2.794523 |    5.469226 | 0.0703525 |
| victim_age       | -0.0067272 | 0.9932953 |    2.682586 |    2.717764 | 0.0429574 |
| victim_raceWhite |  0.8417563 | 2.3204389 |    7.228237 |   14.337558 | 0.0000015 |
| victim_sexMale   | -0.8544628 | 0.4255117 |    1.167292 |    2.006390 | 0.0000000 |
